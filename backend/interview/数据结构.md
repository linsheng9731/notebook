# 红黑树



# LSM (log-structed-merged-tree)
leveldb
rocksdb
Cassandra 
hbase 
都在使用的底层存储结构。

主要思想：
利用磁盘顺序写入的高性能。

将文件分段，段与段之间的内容不重复，每段内容都有序。

在内存中维护 memtable 和 稀疏索引，memtable 主要是以平衡二叉树的形式存储，保证有序。稀疏索引是只在内存中维护文件段的起始key的offset。

当内存中的 memtable 满了就一次性刷写到磁盘中变成 sstable（sorted string table），因为是顺序写入的所以性能很高。

因为内存中的内容可能和磁盘上的文件有重复，所以需要做合并。后台有一个线程按照策略做 compaction，主要有两类策略：固定大小合并、分层合并。固定大小就是当某类固定大小的文件数目达到一定个数就进行合并，生成新的更大的文件。优点是简单，缺点是有空间放大的问题（需要合成新的文件后才能删除老的小文件，所以存储被放大了一倍）。分层合并是将文件划分为多层（大小可能差不多），规定每层的文件个数不超过N。当超过的时候就把文件向下一层进行合并去重（同一层的文件内容不能重复），这样占用的空间就大大减小了。

对于查询的场景，需要遍历memtable和所有的sstable，效率比较低，这里用布隆过滤器进行了预处理，如果在过滤器中找不到说明不存在。

对于容错的场景，每次操作都会先写入log，从失败中恢复的时候会先从 log 中读取。



有 1k 个元素，需要放到集合中，如果让这个插入的过程更加高效？如果使用 ArrayList 的话如果保证插入是最高效的？

请描述一下 BitMap 这种数据结构

BitMap 是一个什么样的数据结构？

它的读写过程分别是怎样的？

它的应用场景有哪些？